<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!--Meta Responsive tag-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Favicon Icon-->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!--Bootstrap CSS-->
    <link rel="stylesheet" href="asset/css/bootstrap.min.css">
    <!--Custom style.css-->
    <link rel="stylesheet" href="asset/css/quicksand.css">
    <link rel="stylesheet" href="asset/css/style.css">
    <!--Font Awesome-->
    <link rel="stylesheet" href="asset/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="asset/css/fontawesome.css">
    <!--Animate CSS-->
    <link rel="stylesheet" href="asset/css/animate.min.css">
    <!--Chartist CSS-->
    <link rel="stylesheet" href="asset/css/chartist.min.css">
    <!--Map-->
    <link rel="stylesheet" href="asset/css/jquery-jvectormap-2.0.2.css">
    <!--Bootstrap Calendar-->
    <link rel="stylesheet" href="asset/js/calendar/bootstrap_calendar.css">
    <!--Nice select -->
    <link rel="stylesheet" href="asset/css/nice-select.css">
    <title>Admin</title>
</head>
<body>
<!--Page loader-->
<div class="loader-wrapper">
    <div class="loader-circle">
        <div class="loader-wave"></div>
    </div>
</div>
<!--Page loader-->

<!--Page Wrapper-->

<div class="container-fluid">

    <!--Header-->
    <div class="row header shadow-sm">

        <!--Logo-->
        <div class="col-sm-3 pl-0 text-center header-logo">
            <div class="bg-theme mr-3 pt-3 pb-2 mb-0">
                <h3 class="logo"><a href="#" class="text-secondary logo"><i class="fa fa-rocket"></i> Admin<span
                        class="small"></span></a></h3>
            </div>
        </div>
        <!--Logo-->

        <!--Header Menu-->
        <div class="col-sm-9 header-menu pt-2 pb-0">
            <div class="row">

                <!--Menu Icons-->
                <div class="col-sm-4 col-8 pl-0">
                    <!--Toggle sidebar-->
                    <span class="menu-icon" onclick="toggle_sidebar()">
                            <span id="sidebar-toggle-btn"></span>
                        </span>
                </div>
            </div>
        </div>
        <!--Header Menu-->
    </div>
    <!--Header-->

    <!--Main Content-->

    <div class="row main-content">
        <!--Sidebar left-->
        <div class="col-sm-3 col-xs-6 sidebar pl-0">
            <div class="inner-sidebar mr-3">
                <!--Image Avatar-->
                <div class="avatar text-center">
                    <img src="asset/img/client-img4.png" alt="" class="rounded-circle"/>
                    <p><strong>Jonathan Clarke</strong></p>
                </div>
                <!--Image Avatar-->

                <!--Sidebar Navigation Menu-->
                <div class="sidebar-menu-container">
                    <ul class="sidebar-menu mt-4 mb-4">
                        <li class="parent">
                            <a href="#"><i class="fa fa-dashboard mr-3"> </i>
                                <span class="none">Class</span>
                            </a>
                        </li>
                        <li class="parent">
                            <a th:href="@{/admin/users}"><i class="fa fa-pencil-square mr-3"></i>
                                <span class="none">User</span>
                            </a>
                        </li>
                        <li class="parent">
                            <a th:href="@{/logout}"><i class="fa fa-puzzle-piece mr-3"></i>
                                <span class="none">Log Out</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!--Sidebar Naigation Menu-->
            </div>
        </div>
        <!--Sidebar left-->

        <!--Content right-->
        <div class="col-sm-9 col-xs-12 content pt-3 pl-0">
            <h5 class="mb-3"><strong>Dashboard</strong></h5>

            <!--Dashboard widget-->
            <div class="mt-1 mb-3 button-container">
                <div class="row pl-0">
                    <div class="col-lg-4 col-md-4 col-sm-6 col-12 mb-3">
                        <div class="bg-white border shadow">
                            <div class="media p-4">
                                <div class="align-self-center mr-3 rounded-circle notify-icon bg-theme">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div class="media-body pl-2">
                                    <h3 class="mt-0 mb-0"><strong th:text="${totalTutor}"></strong></h3>
                                    <p><small class="text-muted bc-description">Tutors</small></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-4 col-sm-6 col-12 mb-3">
                        <div class="bg-white border shadow">
                            <div class="media p-4">
                                <div class="align-self-center mr-3 rounded-circle notify-icon bg-danger">
                                    <i class="fas fa-envelope-open"></i>
                                </div>
                                <div class="media-body pl-2">
                                    <h3 class="mt-0 mb-0"><strong th:text="${totalStudent}"></strong></h3>
                                    <p><small class="text-muted bc-description">Students</small></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-4 col-sm-6 col-12 mb-3">
                        <div class="bg-theme border shadow">
                            <div class="media p-4">
                                <div class="align-self-center mr-3 rounded-circle notify-icon bg-white">
                                    <i class="fa fa-tags text-theme"></i>
                                </div>
                                <div class="media-body pl-2">
                                    <h3 class="mt-0 mb-0"><strong th:text="${totalClass}"></strong></h3>
                                    <p><small class="bc-description text-white">Total Classes</small></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/Dashboard widget-->


            <!--Chart Section-->
            <div class="mt-1 mb-3 p-3 button-container bg-white shadow-sm border">
                <h6>Analytics overview</h6>
                <hr>
                <canvas id="registrationChart" width="400" height="200"></canvas>

            </div>
            <!--Chart Section-->

            <div class="mt-4 mb-4 p-3 bg-white border shadow-sm lh-sm">
                <!--Order Listing-->
                <div class="product-list">

                    <div class="row border-bottom mb-4">
                        <div class="col-sm-8 pt-2">
                            <h6 class="mb-4 bc-header">Class listing</h6>
                        </div>
                    </div>

                    <div>
                        <table class="table table-striped table-bordered" id="classTable">
                            <thead>
                            <tr>
                                <th></th> <!-- Thêm cột STT -->
                                <th>Class ID</th>
                                <th>Tutor ID</th>
                                <th>Student ID</th>
                                <th>Status</th>
                                <th>Fee</th>
                                <th>Payment Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="c, iterStat : ${classes}">
                                <td class="align-middle" th:text="${iterStat.index + 1}"></td> <!-- Hiển thị STT -->
                                <td class="align-middle" th:text="${c.classId}"></td>
                                <td class="align-middle" th:text="${c.tutorId?.tutorId ?: 'N/A'}"></td>
                                <td class="align-middle" th:text="${c.studentId?.studentId ?: 'N/A'}"></td>
                                <td class="align-middle">
                <span class="badge"
                      th:class="${c.status == 'Active' ? 'badge-success' : (c.status == 'Inactive' ? 'badge-danger' : 'badge-warning')}"
                      th:text="${c.status ?: 'Unknown'}"></span>
                                </td>
                                <td th:text="${c.getPrice() != null ? T(java.lang.String).format('%.1f', c.getPrice() * 30 * 0.4) +' $': 'N/A'}"></td>
                                <td class="align-middle">
                <span class="badge"
                      th:class="${c.getPaymentId()?.getStatus() == 'Paid' ? 'badge-success' : (c.getPaymentId()?.getStatus() == 'Processing' ? 'badge-warning' : 'badge-danger')}"
                      th:text="${c.getPaymentId()?.getStatus() ?: 'N/A'}"></span>
                                </td>
                                <td class="align-middle text-center">
                                    <button class="btn btn-theme" data-toggle="modal" data-target="#orderInfo"
                                            title="View Order Info"
                                            th:data-class-id="${c.classId ?: 'N/A'}"
                                            th:data-tutor-name="${c.tutorId?.name ?: 'N/A'}"
                                            th:data-student-name="${c.studentId?.name ?: 'N/A'}"
                                            th:data-grade="${c.grade ?: 'N/A'}"
                                            th:data-subject="${c.subjectId?.subjectName ?: 'N/A'}"
                                            th:data-address="${c.address ?: 'N/A'}"
                                            th:data-time="${c.getStartTime() != null && c.getEndTime() != null && c.getDate() != null ? c.getStartTime() + '-' + c.getEndTime() + ' ' + c.getDate() : 'N/A'}"
                                            th:data-post-date="${c.postDate ?: 'N/A'}">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <form style="display:inline-block;" action="#" th:action="@{/admin/confirm}" method="get" onsubmit="return confirm('Are you sure you want to confirm this deal?');">
                                        <input type="hidden" name="classId" th:value="${c.classId}" />
                                        <button type="submit" class="btn btn-success" title="Update Order" th:if="${c.getPaymentId()?.getStatus() == 'Processing'}">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                    </form>
                                    <form style="display:inline-block;" action="#" th:action="@{/admin/delete}" method="get" onsubmit="return confirm('Are you sure you want to delete this class?');">
                                        <input type="hidden" name="classId" th:value="${c.classId}" />
                                        <button type="submit" class="btn btn-danger" title="Delete Order">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>



                        <div class="text-right mt-4 p-4">
                            <p><strong th:text="'Total Paided Fee: ' + ${totalPaidFee} +'$'"></strong></p>
                            <p><strong th:text="'Total Unpaid Fee: ' + ${totalUnpaidFee} +'$'"></strong></p>
                            <h4 class="mt-2"><strong th:text="'Total Fee: ' + ${totalFee} +'$'"></strong></h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Order Update Modal-->
    </div>
    <!-- Modal -->
    <div class="modal fade" id="orderInfo" tabindex="-1" role="dialog" aria-labelledby="orderInfoLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="orderInfoLabel">Order Information</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>Class ID:</strong> <span id="classId"></span></p>
                    <p><strong>Tutor Name:</strong> <span id="tutorName"></span></p>
                    <p><strong>Student Name:</strong> <span id="studentName"></span></p>
                    <p><strong>Grade:</strong> <span id="grade"></span></p>
                    <p><strong>Subject:</strong> <span id="subject"></span></p>
                    <p><strong>Address:</strong> <span id="address"></span></p>
                    <p><strong>Time:</strong> <span id="time"></span></p>
                    <p><strong>Post Date:</strong> <span id="postDate"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
    document.querySelectorAll('.btn-theme').forEach(button => {
        button.addEventListener('click', function () {
            const classId = this.getAttribute('data-class-id');
            const tutorName = this.getAttribute('data-tutor-name');
            const studentName = this.getAttribute('data-student-name');
            const grade = this.getAttribute('data-grade');
            const subject = this.getAttribute('data-subject');
            const address = this.getAttribute('data-address');
            const time = this.getAttribute('data-time');
            const postDate = this.getAttribute('data-post-date');

            document.getElementById('classId').innerText = classId;
            document.getElementById('tutorName').innerText = tutorName;
            document.getElementById('studentName').innerText = studentName;
            document.getElementById('grade').innerText = grade;
            document.getElementById('subject').innerText = subject;
            document.getElementById('address').innerText = address;
            document.getElementById('time').innerText = time;
            document.getElementById('postDate').innerText = postDate;
        });
    });

</script>
<!--Main Content-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    const ctx = document.getElementById('registrationChart').getContext('2d');
    const monthlyRegistrations = {
        labels: /*[[${labels}]]*/,
        datasets: [
            {
                label: 'Tutors',
                data: /*[[${tutorRegistrations}]]*/,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            },
            {
                label: 'Students',
                data: /*[[${studentRegistrations}]]*/,
                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }
        ]
    };

    const registrationChart = new Chart(ctx, {
        type: 'bar',
        data: monthlyRegistrations,
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Month'
                    },
                    barPercentage: 0.5,
                    categoryPercentage: 0.6
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Registrations'
                    }
                }
            }
        }
    });
</script>

<!--Page Wrapper-->
<!-- Page JavaScript Files-->
<script src="asset/js/jquery.min.js"></script>
<!--Popper JS-->
<script src="asset/js/popper.min.js"></script>
<!--Bootstrap-->
<script src="asset/js/bootstrap.min.js"></script>
<!--Sweet alert JS-->
<script src="asset/js/sweetalert.js"></script>
<!--Progressbar JS-->
<script src="asset/js/progressbar.min.js"></script>
<!--Flot.JS-->
<script src="asset/js/charts/jquery.flot.min.js"></script>
<script src="asset/js/charts/jquery.flot.pie.min.js"></script>
<script src="asset/js/charts/jquery.flot.categories.min.js"></script>
<script src="asset/js/charts/jquery.flot.stack.min.js"></script>
<!--Chart JS-->
<script src="asset/js/charts/chart.min.js"></script>
<!--Chartist JS-->
<script src="asset/js/charts/chartist.min.js"></script>
<script src="asset/js/charts/chartist-data.js"></script>
<script src="asset/js/charts/demo.js"></script>
<!--Maps-->
<script src="asset/js/maps/jquery-jvectormap-2.0.2.min.js"></script>
<script src="asset/js/maps/jquery-jvectormap-world-mill-en.js"></script>
<script src="asset/js/maps/jvector-maps.js"></script>
<!--Bootstrap Calendar JS-->
<script src="asset/js/calendar/bootstrap_calendar.js"></script>
<script src="asset/js/calendar/demo.js"></script>
<!--Nice select-->
<script src="asset/js/jquery.nice-select.min.js"></script>

<!--Custom Js Script-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="asset/js/custom.js"></script>
<!--Custom Js Script-->
<script>
    //Nice select
    $('.bulk-actions').niceSelect();
</script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
<script>
    $(document).ready(function () {
        $('#classTable').DataTable({
            "paging": true,
            "searching": true,
            "ordering": true
        });
    });
</script>
</body>

</html>